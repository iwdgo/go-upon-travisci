From e44430d3de2787c4d181982df2220baab95ffefb Mon Sep 17 00:00:00 2001
From: Constantin Konstantinidis <constantinkonstantinidis@gmail.com>
Date: Sun, 12 Apr 2020 21:28:41 +0200
Subject: [PATCH] cmd/go: remove default output of proxy_test log in tests

Verbose flag (-v) displays details.

Fixes #29515
Fixes #30604

Change-Id: Ie75a331cd6ca51806c5720443506d4fe0bec28cf
---
 src/cmd/go/proxy_test.go | 8 +++++++-
 1 file changed, 7 insertions(+), 1 deletion(-)

diff --git a/src/cmd/go/proxy_test.go b/src/cmd/go/proxy_test.go
index 2a4d2935b3..acdaf96b89 100644
--- a/src/cmd/go/proxy_test.go
+++ b/src/cmd/go/proxy_test.go
@@ -50,6 +50,12 @@ func StartProxy() {
 	proxyOnce.Do(func() {
 		readModList()
 		addr := *proxyAddr
+		quiet := ""
+		if *proxyAddr == "" && !testing.Verbose() && !strings.Contains(proxyURL, "quiet") {
+			// -proxy flag was not used
+			// default is quiet unless -v is requested
+			quiet = "/quiet"
+		}
 		if addr == "" {
 			addr = "localhost:0"
 		}
@@ -58,7 +64,7 @@ func StartProxy() {
 			log.Fatal(err)
 		}
 		*proxyAddr = l.Addr().String()
-		proxyURL = "http://" + *proxyAddr + "/mod"
+		proxyURL = "http://" + *proxyAddr + "/mod" + quiet
 		fmt.Fprintf(os.Stderr, "go test proxy running at GOPROXY=%s\n", proxyURL)
 		go func() {
 			log.Fatalf("go proxy: http.Serve: %v", http.Serve(l, http.HandlerFunc(proxyHandler)))
-- 
2.22.0.windows.1

