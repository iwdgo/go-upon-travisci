language: go

arch: amd64

os:
  - windows
  - linux
  - osx

go: 1.17.x

# env:

install:
  - echo ""

before_script:
  - export GOROOT_BOOTSTRAP=$(go env GOROOT)
  - mkdir golang
  - cd golang
  - git clone --depth=1 --branch master --single-branch --no-tags https://go.googlesource.com/go
  - cd go
  - export GOCLONE=$(pwd)
  - git log -1 --pretty=short
  - cd $TRAVIS_BUILD_DIR

script:
  - cd $GOCLONE/src
  - |
    if [ "$TRAVIS_OS_NAME" == "windows" ]; then 
      all.bat
    else
      sh ./all.bash
    fi

after_success:
  - export GOROOT= # get last commit from version file
  - ./bin/go tool dist version
